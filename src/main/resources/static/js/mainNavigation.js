// Generated by CoffeeScript 1.12.7
(function() {
  this.MainNavigation = (function() {
    function MainNavigation() {
      this.pageAndHash = {
        '#profile': 'profile',
        '#users': 'users',
        '#clients': "clients",
        "#bids": 'bids',
        '#client': 'clients'
      };
      this.currentPage = null;
      this.pageFromTab = true;
      this.pageTitle = $('.js--page--title');
      this.navigationBar = $('.js--nav--bar');
      this.container = $('.js--page--container');
      this.mainNavigation = $('.js--main--navigation');
      this.mainNavigation.on('click', this._mainNavigationHandler.bind(this));
      this._restrictPage();
      $(window).on('hashchange', this._hashChangedHandler.bind(this));
      if (window.location.hash === '') {
        this._redirectToHomepage();
      } else {
        this._handlePage();
      }
    }

    MainNavigation.prototype._handlePage = function() {
      var hashValue, tab;
      hashValue = this._extractHashValue();
      this._openPage(hashValue);
      tab = this.pageAndHash[hashValue.page];
      return this._handleNavigationButtons(tab);
    };

    MainNavigation.prototype._hashChangedHandler = function(event) {
      if (this.currentPage) {
        this.currentPage.destroy();
      }
      this._handlePage();
      return document.title = this.currentPage.getPageTitle();
    };

    MainNavigation.prototype._openPage = function(hash) {
      this.pageFromTab = true;
      switch (hash.page) {
        case '#profile':
          this.currentPage = new UserProfile();
          break;
        case '#users':
          this.currentPage = new UserPage();
          break;
        case '#clients':
          this.currentPage = new ClientsPage();
          break;
        case '#bids':
          this.currentPage = new BidsPage(hash.value);
          break;
        case '#client':
          this.pageFromTab = false;
          return this.currentPage = new ClientProfilePage(hash.value);
        default:
          this._redirectToErrorPage();
      }
    };

    MainNavigation.prototype._restrictPage = function() {
      var onlyAdmin;
      if (!window.isAdmin) {
        onlyAdmin = $('.js--admin--only');
        return onlyAdmin.remove();
      }
    };

    MainNavigation.prototype._handleNavigationButtons = function(tab) {
      $('.js--nav--item').removeClass('active');
      return $(".js--nav--item[data-tab=" + tab + "]").addClass('active');
    };

    MainNavigation.prototype._redirectToHomepage = function() {
      return window.location.hash = "#profile";
    };

    MainNavigation.prototype._redirectToErrorPage = function() {
      window.location.hash = '';
      return window.location.pathname = "/error-404";
    };

    MainNavigation.prototype._mainNavigationHandler = function(event) {
      return this.mainNavigation.toggleClass('open');
    };

    MainNavigation.prototype._extractHashValue = function() {
      var dash, hash, hashObject, page, value;
      hashObject = {};
      hash = window.location.hash;
      dash = hash.indexOf('/');
      page = hash;
      value = null;
      if (dash > 0) {
        page = hash.substring(0, dash);
        value = hash.substring(dash + 1);
      }
      return {
        page: page,
        value: value
      };
    };

    return MainNavigation;

  })();

  $(document).ready(function() {
    return new MainNavigation();
  });

}).call(this);
