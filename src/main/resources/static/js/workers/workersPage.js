// Generated by CoffeeScript 1.12.7
(function() {
  var extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

  this.WorkersPage = (function(superClass) {
    extend(WorkersPage, superClass);

    function WorkersPage() {
      WorkersPage.__super__.constructor.call(this);
      WorkerService.getAll(null, this, this._workersLoadedSuccess, this._workersLoadedError);
      this.createWorkerDialog = new CreateWorkerDialog();
    }

    WorkersPage.prototype.destroy = function() {
      WorkersPage.__super__.destroy.call(this);
      this.createWorkerDialog.destroy();
      return this.createWorkerDialog = null;
    };

    WorkersPage.prototype.getPageTitle = function() {
      return "Radnici";
    };

    WorkersPage.prototype._clickEventHandler = function(event) {
      var id, target;
      target = $(event.target);
      if (closest(target, '.js--create--worker')) {
        this.createWorkerDialog.show();
      }
      if (closest(target, '.js--show--worker')) {
        id = target.attr('data-worker-id');
        return window.location.hash = 'worker/' + id;
      }
    };

    WorkersPage.prototype._workersLoadedSuccess = function(response) {
      this.users = response.data;
      return this.pageHTML();
    };

    WorkersPage.prototype._customHTML = function() {
      var adminOptionsHtml, i, len, ref, rowHtml, tableHtml, u, userIcon;
      adminOptionsHtml = "";
      if (window.loggedUserInfo.isAdmin) {
        adminOptionsHtml = "<nav class='nav justify-content-end pt-3'> <span class='nav-link span-a js--create--worker'>Dodaj radnika</span> </nav> <th class='table-text w-10'>Profil</th>";
      }
      tableHtml = "<div> <table class='table mb-0'> <tr> " + adminOptionsHtml + " <th class='table-text w-20'>Ime</th> <th class='table-text w-20'>Prezime</th> <th class='table-text w-20'>Telefon</th> <th class='table-text w-30'>Email</th> </tr> </table> <table class='table table-striped'>";
      rowHtml = "";
      ref = this.users;
      for (i = 0, len = ref.length; i < len; i++) {
        u = ref[i];
        if (window.loggedUserInfo.isAdmin) {
          if (u.deleted) {
            userIcon = 'blocked-user-icon';
          } else {
            userIcon = 'user-icon';
          }
          adminOptionsHtml = "<td class='table-text w-10'><span class='" + userIcon + " js--show--worker' data-worker-id=" + u.id + "></span></td>";
        }
        rowHtml = "<tr class='js--user--row' data-worker-id=" + u.id + "> " + adminOptionsHtml + " <td class='table-text w-20'>" + (u.firstName || '/') + "</td> <td class='table-text w-20'>" + (u.lastName || '/') + "</td> <td class='table-text w-20'>" + (u.phoneNumber || '/') + "</td> <td class='table-text w-30'>" + (u.email || '/') + "</td> </tr>";
        tableHtml += rowHtml;
      }
      tableHtml += "</table></div>";
      return tableHtml;
    };

    WorkersPage.prototype._workersLoadedError = function(response) {};

    WorkersPage.prototype._pageHTML = function() {
      return this.emptyState();
    };

    WorkersPage.prototype.emptyState = function() {
      return ComponentsUtils.emptyState('Nema unetih radnika :(', "<input type='button' class='btn btn-primary d-block js--create--worker' value='Dodaj radnika'/>");
    };

    return WorkersPage;

  })(AbstractPage);

}).call(this);
