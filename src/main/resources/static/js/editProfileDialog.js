// Generated by CoffeeScript 1.12.7
(function() {
  this.EditProfileDialog = (function() {
    function EditProfileDialog() {
      this.container = $('.js--side--dialog--container');
      this.template = this._html();
      this.clickEvent = this._clickEventHandler.bind(this);
      this.container.on('click', this.clickEvent);
    }

    EditProfileDialog.prototype.show = function(parentController, user) {
      this.parentController = parentController;
      this.container.attr('visibility', true);
      this.container.html(this.template);
      this.negativeButton = this.container.find("." + ComponentsUtils.NEGATIVE_BUTTON);
      this.positiveButton = this.container.find("." + ComponentsUtils.POSITIVE_BUTTON);
      this.firstName = this.container.find('.js--firstName');
      this.lastName = this.container.find('.js--lastName');
      this.street = this.container.find('.js--street');
      this.buildNumber = this.container.find('.js--buildNumber');
      this.city = this.container.find('.js--city');
      this.phoneNumber = this.container.find('.js--phoneNumber');
      this.email = this.container.find('.js--email');
      this.password = this.container.find('.js--password');
      this.password2 = this.container.find('.js--password--2');
      this.firstName.val(user.firstName);
      this.lastName.val(user.lastName);
      this.street.val(user.street);
      this.buildNumber.val(user.buildNumber);
      this.city.val(user.city);
      this.phoneNumber.val(user.phoneNumber);
      return this.email.val(user.email);
    };

    EditProfileDialog.prototype.hide = function() {
      return this.container.attr('visibility', false);
    };

    EditProfileDialog.prototype.save = function() {
      var buildNumber, city, data, firstName, lastName, password, password2, passwordValid, phoneNumber, street, valid;
      valid = true;
      firstName = this.firstName.val().trim();
      lastName = this.lastName.val().trim();
      street = this.street.val().trim();
      buildNumber = this.buildNumber.val().trim();
      city = this.city.val().trim();
      phoneNumber = this.phoneNumber.val().trim();
      password = this.password.val().trim();
      password2 = this.password2.val().trim();
      if (firstName !== '') {
        this.firstName.removeClass(ComponentsUtils.CSS_INVALID_INPUT);
      } else {
        valid = false;
        this.firstName.addClass(ComponentsUtils.CSS_INVALID_INPUT);
      }
      if (lastName !== '') {
        this.lastName.removeClass(ComponentsUtils.CSS_INVALID_INPUT);
      } else {
        valid = false;
        this.lastName.addClass(ComponentsUtils.CSS_INVALID_INPUT);
      }
      if (Validation.phone(phoneNumber)) {
        this.phoneNumber.removeClass(ComponentsUtils.CSS_INVALID_INPUT);
      } else {
        valid = false;
        this.phoneNumber.addClass(ComponentsUtils.CSS_INVALID_INPUT);
      }
      passwordValid = true;
      if (password !== password2) {
        passwordValid = false;
      }
      if (passwordValid && password !== '') {
        passwordValid = Validation.password(password);
      }
      if (passwordValid) {
        this.password.removeClass(ComponentsUtils.CSS_INVALID_INPUT);
        this.password2.removeClass(ComponentsUtils.CSS_INVALID_INPUT);
      } else {
        valid = false;
        this.password.addClass(ComponentsUtils.CSS_INVALID_INPUT);
        this.password2.addClass(ComponentsUtils.CSS_INVALID_INPUT);
      }
      if (!valid) {
        return;
      }
      data = {
        firstName: firstName,
        lastName: lastName,
        street: street,
        buildNumber: buildNumber,
        city: city,
        phoneNumber: phoneNumber,
        password: password
      };
      if (this.parentController && this.parentController.editProfileDialogSuccess) {
        this.parentController.editProfileDialogSuccess(data);
      }
      UserService.changeUserInfo(data, null, this, this._saveSuccess, this._saveError);
      return this.hide();
    };

    EditProfileDialog.prototype.destroy = function() {
      this.container.off('click', this.clickEvent);
      this.clickEvent = null;
      this.template = null;
      return this.parentController = null;
    };

    EditProfileDialog.prototype._html = function() {
      return "<div class='col-7 m-auto h-75 pt-5 flex'> <div class='container w-50'> <div class='form-group'> <label>Ime*</label> <input type='text' class='form-control js--firstName' placeholder='ime'/> </div> <div class='form-group'> <label>Prezime*</label> <input type='text' class='form-control js--lastName' placeholder='prezime'/> </div> <div class='form-group'> <label>Ulica</label> <input type='text' class='form-control js--street' placeholder='ulica'/> </div> <div class='form-group'> <label>Sifra</label> <input type='password' class='form-control js--password' placeholder='********'/> </div> <div class='form-group'> <label>Potvrdi sifru</label> <input type='password' class='form-control js--password--2' placeholder='********'/> </div> </div> <div class='container w-50'> <div class='form-group'> <label>Broj stana</label> <input type='text' class='form-control js--buildNumber' placeholder='broj kuce/stana'/> </div> <div class='form-group'> <label>Grad</label> <input type='text' class='form-control js--city' placeholder='grad'/> </div> <div class='form-group'> <label>Telefon</label> <input type='tel' class='form-control js--phoneNumber' placeholder='telefon'/> </div> <div class='form-group'> <label>Email*</label> <input type='email' class='form-control js--email' disabled='disabled' placeholder='email'/> </div> <div class='form-group form-inline'> <button class='btn btn-lg btn-light btn-block w-50 " + ComponentsUtils.NEGATIVE_BUTTON + "' value='Izmeni'>Otkazi</button> <button class='btn btn-lg btn-primary btn-block w-50 " + ComponentsUtils.POSITIVE_BUTTON + "' value='Izmeni'>Izmeni</button> </div> </div> </div>";
    };

    EditProfileDialog.prototype._clickEventHandler = function(e) {
      var element, target;
      target = $(e.target);
      element = target.closest(this.negativeButton);
      if (element.length !== 0) {
        this.hide();
        return;
      }
      element = target.closest(this.positiveButton);
      if (element.length !== 0) {
        this.save();
      }
    };

    EditProfileDialog.prototype._saveSuccess = function(data) {
      return FloatingMessage.success(data.message);
    };

    EditProfileDialog.prototype._saveError = function(data) {
      return FloatingMessage.error(data.message);
    };

    return EditProfileDialog;

  })();

}).call(this);
